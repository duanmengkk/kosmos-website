<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/tutorials/pv-pvc-dynamic-storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Multi-cluster PV/PVC Dynamic Storage | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://duanmengkk.github.io&#x27;/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://duanmengkk.github.io&#x27;/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://duanmengkk.github.io&#x27;/website/v0.2.0/tutorials/pv-pvc-dynamic-storage"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-cluster PV/PVC Dynamic Storage | Kosmos"><meta data-rh="true" name="description" content="Multi-cluster PV/PVC Dynamic Storage Implementation"><meta data-rh="true" property="og:description" content="Multi-cluster PV/PVC Dynamic Storage Implementation"><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/tutorials/pv-pvc-dynamic-storage"><link data-rh="true" rel="alternate" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/tutorials/pv-pvc-dynamic-storage" hreflang="en"><link data-rh="true" rel="alternate" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/tutorials/pv-pvc-dynamic-storage" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.f49b5b88.css">
<script src="/website/assets/js/runtime~main.3416bce9.js" defer="defer"></script>
<script src="/website/assets/js/main.dace5895.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a href="https://kosmos-io.github.io/website/v0.2.0/quick-start" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcn-connectivity">Multi-cluster Network Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage">Multi-cluster PV/PVC Dynamic Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXEC and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/application-migration">Application Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/kubenest">Kubenest</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/performance-testing">Kosmos Performance Testing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-cluster PV/PVC Dynamic Storage</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Multi-cluster PV/PVC Dynamic Storage Solution</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-cluster-pvpvc-dynamic-storage-implementation">Multi-cluster PV/PVC Dynamic Storage Implementation<a href="#multi-cluster-pvpvc-dynamic-storage-implementation" class="hash-link" aria-label="Direct link to Multi-cluster PV/PVC Dynamic Storage Implementation" title="Direct link to Multi-cluster PV/PVC Dynamic Storage Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3>
<p>This document mainly introduces the implementation of PV/PVC storage management for stateful service-related Pods in Kosmos across clusters.
It provides a detailed explanation of the processes involved in creating, updating, and binding PV and PVC for Pods.
Through this document, you can gain a comprehensive understanding of the details of managing stateful services in Kosmos.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>The current implementation is an intermediate version, and further optimization will be done for global storage.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="approach">Approach<a href="#approach" class="hash-link" aria-label="Direct link to Approach" title="Direct link to Approach">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="roles-of-pvc-pv-and-sc-in-a-single-kubernetes-cluster">Roles of PVC, PV, and SC in A Single Kubernetes Cluster<a href="#roles-of-pvc-pv-and-sc-in-a-single-kubernetes-cluster" class="hash-link" aria-label="Direct link to Roles of PVC, PV, and SC in A Single Kubernetes Cluster" title="Direct link to Roles of PVC, PV, and SC in A Single Kubernetes Cluster">​</a></h4>
<ol>
<li>Persistent Volume (PV):</li>
</ol>
<ul>
<li>PV is a storage volume resource in a Kubernetes cluster that abstracts and separates it from the actual storage backend.</li>
<li>PV can be any form of storage, such as network storage, local storage, cloud storage, etc.</li>
<li>PVs can be pre-created by the PV administrator or dynamic storage plugins in the cluster. They can also be dynamically created to fulfill the requirements of PVC.</li>
<li>PV describes storage attributes such as capacity, access modes (e.g., read/write), and reclaim policies.</li>
</ul>
<ol start="2">
<li>Persistent Volume Claim (PVC):</li>
</ol>
<ul>
<li>PVC is the application&#x27;s request for storage resources. It specifies the required storage capacity and other properties, such as access modes and volume modes, in the Pod.</li>
<li>Applications use PVC to declare their storage requirements without specifying the actual storage location or type. Kubernetes matches PVC requirements with available PVs in the cluster to fulfill the PVC&#x27;s needs.</li>
<li>PVC can request dynamically provisioned matching PVs or manually select specific PV objects.</li>
</ul>
<ol start="3">
<li>StorageClass (SC):</li>
</ol>
<ul>
<li>SC defines the dynamic provisioning strategy for PVs. It specifies how to automatically create PVs based on PVC requirements.</li>
<li>When a PVC requests a specific StorageClass, Kubernetes creates PV according to the rules defined in the StorageClass and automatically binds the PV to the PVC.</li>
<li>StorageClass allows different types of storage to be defined, providing different storage options for different applications.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pvc-pv-storageclass-implementation-process-in-a-single-kubernetes-cluster">PVC, PV, StorageClass Implementation Process in A Single Kubernetes Cluster<a href="#pvc-pv-storageclass-implementation-process-in-a-single-kubernetes-cluster" class="hash-link" aria-label="Direct link to PVC, PV, StorageClass Implementation Process in A Single Kubernetes Cluster" title="Direct link to PVC, PV, StorageClass Implementation Process in A Single Kubernetes Cluster">​</a></h4>
<ul>
<li>When a Pod in the application needs access to persistent storage, a PVC object is created to declare the desired storage.</li>
<li>Based on the requirements defined in the PVC, Kubernetes matches it with suitable PVs through the StorageClass and binds them.</li>
<li>After successful binding between PV and PVC, the application can directly use the storage provided by PVC and mount the storage path in the Pod.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="storageclass-volume-binding-modes">StorageClass Volume Binding Modes<a href="#storageclass-volume-binding-modes" class="hash-link" aria-label="Direct link to StorageClass Volume Binding Modes" title="Direct link to StorageClass Volume Binding Modes">​</a></h4>
<p>The &#x27;volumeBindingMode&#x27; field in StorageClass definition specifies how the dynamic provisioner binds PVC and PV.
Here are several common volume binding modes:</p>
<ul>
<li>Immediate: In this mode, the provisioner immediately binds an available PV to the PVC. If there are no available PVs matching the requirements of the PVC, the PVC remains in the Pending state.</li>
<li>WaitForFirstConsumer: In this mode, the provisioner waits until a Pod referencing the PVC attempts to mount the volume before allocating a PV. The PV is dynamically bound when the PVC is consumed by the Pod.</li>
<li>Cluster: This is the default binding mode. PV is immediately assigned to PVC. This mode is similar to &#x27;Immediate&#x27;, but it allows the cluster administrator to override the default binding mode of StorageClass. Each StorageClass can have only one binding mode, and once set, it cannot be changed.</li>
</ul>
<p>Choose the appropriate binding mode based on your needs and environment configuration.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="csi-dynamic-volume-provisioning-related-process">CSI (Dynamic Volume Provisioning) Related Process<a href="#csi-dynamic-volume-provisioning-related-process" class="hash-link" aria-label="Direct link to CSI (Dynamic Volume Provisioning) Related Process" title="Direct link to CSI (Dynamic Volume Provisioning) Related Process">​</a></h4>
<ol>
<li>User creates a Pod + PVC.</li>
<li>The VolumeController&#x27;s PersistentVolumeController control loop detects the creation of PVC and skips it since it uses the Out-of-Tree mode.
This control loop mainly handles PV and PVC binding in the In-Tree mode.</li>
<li>External-provisioner detects the creation of PVC:</li>
</ol>
<ul>
<li>Calls the &#x27;CreateVolume&#x27; method of the Controller Service to create the underlying storage volume.
At this point, the volume is in the CREATED state and exists only in the storage system, not visible to any nodes or containers.</li>
<li>Creates PV.</li>
<li>Binds the PV to the PVC (binding: fills the name of this PV object in the spec.volumeName field of the PVC object).</li>
</ul>
<ol start="4">
<li>The VolumeController&#x27;s AttachDetachController control loop detects that the volume is not attached to the host and needs an Attach operation.
It creates the &#x27;VolumeAttachment&#x27; object.</li>
<li>When the external-attacher detects the creation of the &#x27;VolumeAttachment&#x27; resource, it calls the &#x27;ControllerPublishVolume&#x27; method of the Controller Service.
At this point, the volume is in the NODE_READY state, meaning the Node can detect the volume but it is still invisible inside the container.</li>
<li>The Kubelet&#x27;s VolumeManagerReconciler control loop:</li>
</ol>
<ul>
<li>Performs the MountDevice operation by calling the &#x27;NodeStageVolume&#x27; method of the Node Service.
This method mainly handles formatting the volume and mounting it to a temporary directory (Staging directory).
After this operation, the volume enters the VOL_READY state.</li>
<li>Performs the SetUp operation by calling the &#x27;NodePublishVolume&#x27; method of the Node Service.</li>
<li>It binds the Staging directory and mounts it to the corresponding host directory of the volume.</li>
<li>The volume enters the PUBLISHED state, and users can now use it normally.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="across-clusters-implementation">Across-clusters Implementation<a href="#across-clusters-implementation" class="hash-link" aria-label="Direct link to Across-clusters Implementation" title="Direct link to Across-clusters Implementation">​</a></h4>
<p>Based on the above PVC, PV, StorageClass logic in a single Kubernetes cluster, and combined with the logic of creating Pod instances across clusters in Kosmos, the implementation approach for PV/PVC across clusters is as follows</p>
<ul>
<li>In the host cluster (Host-Cluster), the volumeBindingMode of StorageClass is set to WaitForFirstConsumer, ensuring delayed binding and configuration of PV (waiting for synchronization with the member cluster) until a Pod using PersistentVolumeClaim is created.
PersistentVolumes will be selected or configured based on scheduling constraints specified in Pod, including resource requirements, node selectors, pod affinities and anti-affinities, taints, and tolerations.</li>
<li>PVC and PV binding in the host cluster (Host-Cluster) should be consistent with the creation of Pods across clusters in Kosmos.</li>
<li>The PV controller in the host cluster (Host-Cluster) only handles PV deletion events, and creation and updates are operated by the PV controller in the member clusters.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flow">Flow<a href="#flow" class="hash-link" aria-label="Direct link to Flow" title="Direct link to Flow">​</a></h3>
<p>The implementation flow of Kosmos PV/PVC is as follows:</p>
<p><img decoding="async" loading="lazy" alt="PV_PVC_Dynamic_Storage.png" src="/website/assets/images/PV_PVC_Dynamic_Storage-0b5e75726205965064b4fb0aedbe8233.png" width="1590" height="1652" class="img_ev3q"></p>
<ul>
<li>When a Pod is created in the host cluster (Host-Cluster) and there is an associated PVC request, Kosmos will create the corresponding PVC in the member cluster based on the Pod creation event.</li>
<li>After the PVC is created in the member cluster (Member-Cluster), the process follows the same flow as in a single Kubernetes cluster, including completion of Pod creation, PVC creation, PV creation, and PVC-PV binding.</li>
<li>When PV is created in the member cluster (Member-Cluster), the corresponding PV controller will create the PV in the host cluster (Host-Cluster) based on the PV creation event.</li>
<li>After successful scheduling in the member cluster (Member-Cluster) and binding of PVC and PV, the PV creation in the host cluster (Host-Cluster) completes the binding of PVC and PV.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="related">Related<a href="#related" class="hash-link" aria-label="Direct link to Related" title="Direct link to Related">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling-module-host-cluster">Scheduling Module (Host-Cluster)<a href="#scheduling-module-host-cluster" class="hash-link" aria-label="Direct link to Scheduling Module (Host-Cluster)" title="Direct link to Scheduling Module (Host-Cluster)">​</a></h4>
<p>This module can be implemented by extending the VolumeBinding plugin in the Kosmos Scheduler.
It can be achieved by using a virtual node with the taint &quot;kosmos.io/node=true<!-- -->:NoSchedule<!-- -->&quot;.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="orchestration-module">Orchestration Module<a href="#orchestration-module" class="hash-link" aria-label="Direct link to Orchestration Module" title="Direct link to Orchestration Module">​</a></h4>
<p>This module&#x27;s implementation is mainly based on the steps described in Section 3, including root_pod_controller.go, root_pvc_controller.go, leaf_pvc_controller.go, root_pv_controller.go, and leaf_pv_controller.go in the cluster-manager of Kosmos.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="demo">Demo<a href="#demo" class="hash-link" aria-label="Direct link to Demo" title="Direct link to Demo">​</a></h3>
<ol>
<li>YAML Example:</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage: 1Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storageClassName: openebs-hostpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      deletionGracePeriodSeconds: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nodeAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nodeSelectorTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - key: kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      - kosmos-cluster38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: &quot;kosmos.io/node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator: &quot;Equal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect: &quot;NoSchedule&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: registry.paas/cnp/nginx:1.14-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          claimName: &quot;nginx-pvc&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Executing the creation operation in the Host cluster:</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster ylc]# kubectl apply -f test.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persistentvolumeclaim/nginx-pvc created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/nginx-new created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster ylc]# kubectl get all -n test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx-new-5677468b6c-ns9k2   0/1     Pending   0          5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/nginx-new   0/1     1            0           5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                   DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/nginx-new-5677468b6c   1         1         0       5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster ylc]# kubectl get all -n test-new -owide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE   IP              NODE               NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx-new-5677468b6c-ns9k2   1/1     Running   0          11s   10.*.*.252   kosmos-cluster38   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                SELECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/nginx-new   1/1     1            1           11s   nginx        nginx:1.14-alpine   app=nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                   DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                SELECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replicaset.apps/nginx-new-5677468b6c   1         1         1       11s   nginx        nginx:1.14-alpine   app=nginx,pod-template-hash=56774</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster ylc]# kubectl get pvc -n test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS       AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-pvc   Bound    pvc-ad86ef86-23c1-407e-a8e7-0b3e44d36254   1Gi        RWO            openebs-hostpath   21s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Querying the status in the Member cluster:</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@cluster38 ~]# kubectl get all -n test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/nginx-new-5677468b6c-ns9k2   1/1     Running   0          2m36s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@cluster38 ~]# kubectl get pvc -n test-new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS       AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx-pvc   Bound    pvc-ad86ef86-23c1-407e-a8e7-0b3e44d36254   1Gi        RWO            openebs-hostpath   2m41s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3>
<p>The dynamic storage implementation of PV/PVC in Kosmos needs to be extended to support global storage.
The current implementation has a smaller granularity. Further improvements and evolution are needed.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/tutorials/pv-pvc-dynamic-storage.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/tutorials/mcn-connectivity"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multi-cluster Network Connectivity</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/tutorials/exe-and-log"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Design of EXEC and Log in Kosmos</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#multi-cluster-pvpvc-dynamic-storage-implementation" class="table-of-contents__link toc-highlight">Multi-cluster PV/PVC Dynamic Storage Implementation</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#approach" class="table-of-contents__link toc-highlight">Approach</a></li><li><a href="#flow" class="table-of-contents__link toc-highlight">Flow</a></li><li><a href="#related" class="table-of-contents__link toc-highlight">Related</a></li><li><a href="#demo" class="table-of-contents__link toc-highlight">Demo</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>