<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/proposals/distribution-policy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Distribution Policy | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://duanmengkk.github.io&#x27;/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://duanmengkk.github.io&#x27;/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://duanmengkk.github.io&#x27;/website/v0.2.0/proposals/distribution-policy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Distribution Policy | Kosmos"><meta data-rh="true" name="description" content="Summary"><meta data-rh="true" property="og:description" content="Summary"><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/proposals/distribution-policy"><link data-rh="true" rel="alternate" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/proposals/distribution-policy" hreflang="en"><link data-rh="true" rel="alternate" href="https://duanmengkk.github.io&#x27;/website/v0.2.0/proposals/distribution-policy" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.f49b5b88.css">
<script src="/website/assets/js/runtime~main.3416bce9.js" defer="defer"></script>
<script src="/website/assets/js/main.dace5895.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a href="https://kosmos-io.github.io/website/v0.2.0/quick-start" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcn-connectivity">Multi-cluster Network Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage">Multi-cluster PV/PVC Dynamic Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXEC and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/application-migration">Application Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/kubenest">Kubenest</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/performance-testing">Kosmos Performance Testing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Proposals</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Distribution Policy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Distribution Policy</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>Kosmos provides a multi-cluster scheduler (kosmos-scheduler) and some scheduling plugins.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation--user-stories">Motivation &amp; User Stories<a href="#motivation--user-stories" class="hash-link" aria-label="Direct link to Motivation &amp; User Stories" title="Direct link to Motivation &amp; User Stories">​</a></h2>
<ol>
<li><code>distributionpolicy</code>: During the product migration process, we hope that the pods created by the user operator can be scheduled to the member cluster without modifying the user&#x27;s code. Therefore, we provide the distributionpolicy plugin to schedule to the desired nodes (host node, leaf node, mix node) according to matching rules (namespace, labelselector, name and other fields)</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-details">Design Details<a href="#design-details" class="hash-link" aria-label="Direct link to Design Details" title="Direct link to Design Details">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="distributionpolicy--clusterdistributionpolicy">DistributionPolicy &amp; ClusterDistributionPolicy<a href="#distributionpolicy--clusterdistributionpolicy" class="hash-link" aria-label="Direct link to DistributionPolicy &amp; ClusterDistributionPolicy" title="Direct link to DistributionPolicy &amp; ClusterDistributionPolicy">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="crd-api">CRD API<a href="#crd-api" class="hash-link" aria-label="Direct link to CRD API" title="Direct link to CRD API">​</a></h4>
<p><a href="https://github.com/kosmos-io/kosmos/pull/321" target="_blank" rel="noopener noreferrer">Code</a> responsible for working with DistributionPolicy and ClusterDistributionPolicy CRD API will be imported in the kosmos-scheduler plugins repo. DistributionPolicy is namespace scope and ClusterDistributionPolicy is cluster scope.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="filter-extension-points-implementation-details">Filter extension points implementation details<a href="#filter-extension-points-implementation-details" class="hash-link" aria-label="Direct link to Filter extension points implementation details" title="Direct link to Filter extension points implementation details">​</a></h4>
<p>Since target resources distribution policies are stored in the CRD (DistributionPolicy &amp; ClusterDistributionPolicy), kosmos-scheduler should be subscribed for updates of appropriate CRD type. kosmos-scheduler will use informers which will be generated with the name dpInformer(cdpInformer). CRD will contian in ResourceSelectors and PolicyTerms. ResourceSelectors used to select resources and is required. PolicyTerms represents the rule for select nodes to distribute resources.</p>
<p><strong>Description of the ResourceSelectors rules</strong></p>
<ol>
<li>ResourceSelectors is required</li>
<li>Prioritize matching of high-precision rule
In case of two ResourceSelector, the one with a more precise
matching rules in ResourceSelectors wins:</li>
</ol>
<ul>
<li>Namespace-scope resources have higher priority  than cluster-scope resources</li>
<li>For namespace-scope resources, matching by name (resourceSelector.name) has higher priority than by namePrefix (resourceSelector.namePrefix)</li>
<li>For namespace-scope resources, matching by namePrefix (resourceSelector.namePrefix) has higher priority than by selector(resourceSelector.labelSelector)</li>
<li>For cluster-scope resources, matching by name (resourceSelector.name) has higher priority than by namePrefix (resourceSelector.namePrefix)</li>
<li>For cluster-scope resources, matching by NamePrefix (resourceSelector.namePrefix) has higher priority than by selector(resourceSelector.labelSelector)
The more the precise, the higher the priority. Defaults to zero which means schedule to the mix node.</li>
</ul>
<p><strong>PolicyTerms</strong></p>
<ol>
<li>PolicyTerms is required</li>
<li>The current node scheduling policy is divided into four nodeTypes （host, leaf, mix, adv）.</li>
<li>Advanced options will be supported in the future. Sure as NodeSelector, Affinity and so on.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use cases<a href="#use-cases" class="hash-link" aria-label="Direct link to Use cases" title="Direct link to Use cases">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="distributionpolicy-crd">DistributionPolicy CRD<a href="#distributionpolicy-crd" class="hash-link" aria-label="Direct link to DistributionPolicy CRD" title="Direct link to DistributionPolicy CRD">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: DistributionPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kosmos-node-distribution-policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-name-scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceSelectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namePrefix: busybox-prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          example-distribution-policy: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policyTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: adv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: adv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advancedTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        advNode: &quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clusterdistributionpolicy-crd">ClusterDistributionPolicy CRD<a href="#clusterdistributionpolicy-crd" class="hash-link" aria-label="Direct link to ClusterDistributionPolicy CRD" title="Direct link to ClusterDistributionPolicy CRD">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterDistributionPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kosmos-node-cluster-distribution-policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resourceSelectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: cluster-busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namePrefix: cluster-busybox-prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          example-distribution-policy: cluster-busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      policyName: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  policyTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: leaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: mix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: adv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeType: adv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advancedTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeName: kosmos-member2-cluster-1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-plans">Test plans<a href="#test-plans" class="hash-link" aria-label="Direct link to Test plans" title="Direct link to Test plans">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparatory-work">Preparatory Work<a href="#preparatory-work" class="hash-link" aria-label="Direct link to Preparatory Work" title="Direct link to Preparatory Work">​</a></h3>
<p>First, Kosmos needs to be <a href="https://kosmos-io.github.io/website/v0.2.0/quick-start" target="_blank" rel="noopener noreferrer">deployed successfully</a> (at least the clustertree module is deployed) and join the member cluster correctly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-the-kosmos-scheduler">Deploy the Kosmos-scheduler<a href="#deploy-the-kosmos-scheduler" class="hash-link" aria-label="Direct link to Deploy the Kosmos-scheduler" title="Direct link to Deploy the Kosmos-scheduler">​</a></h3>
<ol>
<li>Configure scheduler and scheduling policy</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f kosmos/deploy/scheduler/.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Verify the kosmos-scheduler service</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kosmos-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-scheduler-8f96d87d7-ssxrx             1/1     Running   0          24s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-a-sample">Try a Sample<a href="#try-a-sample" class="hash-link" aria-label="Direct link to Try a Sample" title="Direct link to Try a Sample">​</a></h3>
<ol>
<li>Use case yaml（busybox.yaml）</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-name-scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        example-distribution-policy: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  app: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              topologyKey: kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      schedulerName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: busybox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          image: busybox:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - sleep 3000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Other Operation instructions</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List all nodes in the host cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       STATUS     ROLES                       AGE   VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-1           Ready      control-plane,master,node   21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-2           Ready      node                        21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-1   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-2   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show the taint information on the virtual node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-1  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-2  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Scheduling by the kosmos-scheduler (hybrid scheduling)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f  busybox.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show instances (hybrid) scheduling result in host cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-name-scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">busybox-69855845c9-2pl7f   1/1     Running   0          14s   10.xx.xx.12     kosmoscluster1-1           &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">busybox-69855845c9-54cm9   1/1     Running   0          14s   10.xx.xx.92     kosmoscluster1-2           &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">busybox-69855845c9-9gjs9   1/1     Running   0          14s   10.xx.xx.80     kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show instances (hybrid) scheduling result in member cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-name-scope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">busybox-69855845c9-9gjs9   1/1     Running   0          14s   10.xx.xx.80     kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/proposals/distribution-policy.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/proposals/k8s-in-k8s"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes in Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/proposals/leaf-node-generate-rules"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Leaf Node Generate Rules</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#motivation--user-stories" class="table-of-contents__link toc-highlight">Motivation &amp; User Stories</a></li><li><a href="#design-details" class="table-of-contents__link toc-highlight">Design Details</a><ul><li><a href="#distributionpolicy--clusterdistributionpolicy" class="table-of-contents__link toc-highlight">DistributionPolicy &amp; ClusterDistributionPolicy</a></li></ul></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use cases</a><ul><li><a href="#distributionpolicy-crd" class="table-of-contents__link toc-highlight">DistributionPolicy CRD</a></li><li><a href="#clusterdistributionpolicy-crd" class="table-of-contents__link toc-highlight">ClusterDistributionPolicy CRD</a></li></ul></li><li><a href="#test-plans" class="table-of-contents__link toc-highlight">Test plans</a><ul><li><a href="#preparatory-work" class="table-of-contents__link toc-highlight">Preparatory Work</a></li><li><a href="#deploy-the-kosmos-scheduler" class="table-of-contents__link toc-highlight">Deploy the Kosmos-scheduler</a></li><li><a href="#try-a-sample" class="table-of-contents__link toc-highlight">Try a Sample</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>